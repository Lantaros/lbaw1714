# A5: Relational Schema, validation and schema refinement

 GROUP1714, 18/03/2018

* Daniel Ribeiro de Pinho - up201505302@fe.up.pt

* Francisco José Sousa Silva - up201502860@fe.up.pt

* Rui André Rebolo Fernandes Leixo - up201504818@fe.up.pt

* Vitor Emanuel Fernandes Magalhães - up201503447@fe.up.pt


## 1. Relational Schema

> The Relational Schema includes the relation schemas, attributes, domains, primary keys, foreign keys and other integrity rules: UNIQUE, DEFAULT, NOT NULL, CHECK.
> Relation schemas are specified in the compact notation:

| Relation reference | Relation Compact Notation                                            |
| ------------------ | -------------------------------------------------------------------- |
| R01                | Event_EventAdmin(__idEvent->Event__, __idEventAdmin->EventAdmin__)                       |
| R02                | Event_Member(__idEvent->Event__, __idMember->Member__)					 |
| R03		              | Comment(__idComment__, text **NN**, timestamp **NN**, idEvent->Event, idMember->Member) 				|
| R04		              | Ticket(__idTicket__, idTicketType->TicketType, idMember->Member) |
| R05		              | TicketType(__idTicketType__, type **NN**, price **CK price > 0 NN**, initialQuantity **CK initialQuantity > 0 NN**, availableQuantity **CK availableQuantity > 0 NN**, description) |
| R06                | Invoice(__idInvoice__, name, taxPayerNumber, adress, quantity **NN**, amount **NN**, date **NN**)   |
| R07                | Community(__idCommunity__, name **NN**, description **NN**, creationDate **NN**, imagePath, publicLink **UK**, isPublic **NN**) |
| R08                | Community_Member(__idCommunity->Community__, __idMember->Member__) |
| R09                | Community_CommunityCategory(__idCommunity->Community__, __idCommunityCategory->CommunityCategory__) |
| R10                | Community_CommunityAdmin(__idCommunity->Community__, __idCommunityAdmin->CommunityAdmin__)
| R11                | Member(__idMember__, name **NN**, username **UK** **NN**, password **NN**, birthdate **NN**, email **UK** **NN**, country, city, address, taxPayerNumber, about, profilePicture, registrationDate **NN**, sentEmailVerification **NN**, verifiedEmail **NN**, isWebSiteAdmin **NN**) |
| R12                | Friend(__idFriend1->Member__, __idFriend2->Member__, accepted **NN**) |
| R13                | CommunityAdmin(__idCommunityAdmin->Member__) |
| R14                | CommunityCategory(__idCommunityCategory__, name **NN**)                                         |
| R15                | EventAdmin(__idEventAdmin->Member__)
| R16                | Report(__idReport__, timestamp, context **NN**, idCommunity->Community, idMember->Member, idEvent-Event, idComment->Comment) |
| R17                | Notification(__idNotification__, idCommunity->Community, idMember->Member, idEvent-Event, idComment->Comment) |
| R18                | Event(__idEvent__, name **NN**, description **NN**, imagePath, date **NN**, country **NN**, city **NN**, address **NN**, publicLink **UK**, isPublic **NN**, idCommunity->Community)                                         |
| R19                | EventCategory(__idEventCategory__, name **NN**)                                         |
| R20                | Event_EventCategory(__idEvent->Event__, __idEventCategory->EventCategory__)               |

## 2. Domains

The specification of additional domains can also be made in a compact form, using the notation:

| Domain Name | Domain Specification           |
| ----------- | ------------------------------ |
| Today	      | DATE DEFAULT CURRENT_DATE      |
| Priority    | ENUM ('High', 'Medium', 'Low') |


## 3. Functional Dependencies and schema validation

<table>
  <tr>
    <th colspan="2">Table R01 (Event_EventAdmin)</th>
  </tr>
  <tr>
   <td colspan="2"><strong>Keys</strong>: { idEvent, idEventAdmin }</td>
  </tr>
  <tr>
    <td colspan="2"><strong>Functional Dependencies</strong></td>
  </tr>
  <tr>
    <td>FD0101</td>
    <td>{idEvent} → {idEvent, idEventAdmin}</td>
  </tr>
   <tr>
    <td>FD0102</td>
    <td>{idEventAdmin} → {idEventAdmin, idEvent}</td>
  </tr>
  <tr>
    <td><strong>Normal Form</strong></td>
    <td>BCNF</td>
  </tr>
</table>

<table>
  <tr>
    <th colspan="2">Table R02 (Event_Member)</th>
  </tr>
  <tr>
   <td colspan="2"><strong>Keys</strong>: { idEvent, idMember  }</td>
  </tr>
  <tr>
    <td colspan="2"><strong>Functional Dependencies</strong></td>
  </tr>
  <tr>
    <td>FD0201</td>
    <td>{idEvent} → {idEvent, idMember}</td>
  </tr>
   <tr>
    <td>FD0202</td>
    <td>{idMember} → {idEvent, idMember}</td>
  </tr>
  <tr>
    <td><strong>Normal Form</strong></td>
    <td>BCNF</td>
  </tr>
</table>

<table>
  <tr>
    <th colspan="2">Table R03 (Comment)</th>
  </tr>
  <tr>
   <td colspan="2"><strong>Keys</strong>: { idComment }</td>
  </tr>
  <tr>
    <td colspan="2"><strong>Functional Dependencies</strong></td>
  </tr>
  <tr>
    <td>FD0301</td>
    <td>{idComment} → {idComment, text, timestamp, idEvent, idMember}</td>
  </tr>
  <tr>
    <td><strong>Normal Form</strong></td>
    <td>BCNF</td>
  </tr>
</table>

<table>
  <tr>
    <th colspan="2">Table R04 (Ticket)</th>
  </tr>
  <tr>
   <td colspan="2"><strong>Keys</strong>: { idTicket }</td>
  </tr>
  <tr>
    <td colspan="2"><strong>Functional Dependencies</strong></td>
  </tr>
  <tr>
    <td>FD0401</td>
    <td>{idTicket} → {idTicket, idTicketType, idMember}</td>
  </tr>
  <tr>
    <td><strong>Normal Form</strong></td>
    <td>BCNF</td>
  </tr>
</table>

<table>
  <tr>
    <th colspan="2">Table R05 (TicketType)</th>
  </tr>
  <tr>
   <td colspan="2"><strong>Keys</strong>: { idTicketType }</td>
  </tr>
  <tr>
    <td colspan="2"><strong>Functional Dependencies</strong></td>
  </tr>
  <tr>
    <td>FD0501</td>
    <td>{idTicketType} → {idTicketType, type, price, initialQuantity, availableQuantity, description}</td>
  </tr>
  <tr>
    <td><strong>Normal Form</strong></td>
    <td>BCNF</td>
  </tr>
</table>

<table>
  <tr>
    <th colspan="2">Table R06 (Invoice)</th>
  </tr>
  <tr>
   <td colspan="2"><strong>Keys</strong>: { idInvoice }</td>
  </tr>
  <tr>
    <td colspan="2"><strong>Functional Dependencies</strong></td>
  </tr>
  <tr>
    <td>FD0601</td>
    <td>{idInvoice} → {idInvoice, name, taxPayerNumber, adress, quantity, amount, date}</td>
  </tr>
  <tr>
    <td><strong>Normal Form</strong></td>
    <td>BCNF</td>
  </tr>
</table>

<table>
  <tr>
    <th colspan="2">Table R07 (Community)</th>
  </tr>
  <tr>
   <td colspan="2"><strong>Keys</strong>: { idCommunity }</td>
  </tr>
  <tr>
    <td colspan="2"><strong>Functional Dependencies</strong></td>
  </tr>
  <tr>
    <td>FD0701</td>
    <td>{idCommunity} → {idCommunity, name, description, creationDate, imagePath, publicLink, isPublic}</td>
  </tr>
  <tr>
    <td><strong>Normal Form</strong></td>
    <td>BCNF</td>
  </tr>
</table>

<table>
  <tr>
    <th colspan="2">Table R08 (Community_Member)</th>
  </tr>
  <tr>
   <td colspan="2"><strong>Keys</strong>: { idCommunity, idMember }</td>
  </tr>
  <tr>
    <td colspan="2"><strong>Functional Dependencies</strong></td>
  </tr>
  <tr>
    <td>FD0801</td>
    <td>{idCommunity} → {idCommunity, idMember}</td>
  </tr>
    <tr>
    <td>FD0802</td>
    <td>{idMember} → {idCommunity, idMember}</td>
  </tr>
  <tr>
    <td><strong>Normal Form</strong></td>
    <td>BCNF</td>
  </tr>
</table>

<table>
  <tr>
    <th colspan="2">Table R09 (Community_CommunityCategory)</th>
  </tr>
  <tr>
   <td colspan="2"><strong>Keys</strong>: { idCommunity, idCommunityCategory }</td>
  </tr>
  <tr>
    <td colspan="2"><strong>Functional Dependencies</strong></td>
  </tr>
  <tr>
    <td>FD0901</td>
    <td>{idCommunity} → {idCommunity, idCommunityCategory}</td>
  </tr>
    <tr>
    <td>FD0902</td>
    <td>{idCommunityCategory} → {idCommunity, idCommunityCategory}</td>
  </tr>
  <tr>
    <td><strong>Normal Form</strong></td>
    <td>BCNF</td>
  </tr>
</table>

<table>
  <tr>
    <th colspan="2">Table R10 (Community_CommunityAdmin)</th>
  </tr>
  <tr>
   <td colspan="2"><strong>Keys</strong>: { idCommunity, idCommunityAdmin }</td>
  </tr>
  <tr>
    <td colspan="2"><strong>Functional Dependencies</strong></td>
  </tr>
  <tr>
    <td>FD1001</td>
    <td>{idCommunity} → {idCommunity, idCommunityAdmin}</td>
  </tr>
    <tr>
    <td>FD1002</td>
    <td>{idCommunityAdmin} → {idCommunity, idCommunityAdmin}</td>
  </tr>
  <tr>
    <td><strong>Normal Form</strong></td>
    <td>BCNF</td>
  </tr>
</table>

<table>
  <tr>
    <th colspan="2">Table R11 (Member)</th>
  </tr>
  <tr>
   <td colspan="2"><strong>Keys</strong>: { idMember }</td>
  </tr>
  <tr>
    <td colspan="2"><strong>Functional Dependencies</strong></td>
  </tr>
  <tr>
    <td>FD1101</td>
    <td>{idMember} → {idMember, name, username, password, birthdate, email, country, city, address, taxPayerNumber, about, profilePicture, registrationDate, sentEmailVerification, verifiedEmail, isWebSiteAdmin}</td>
  </tr>
  <tr>
    <td><strong>Normal Form</strong></td>
    <td>BCNF</td>
  </tr>
</table>

<table>
  <tr>
    <th colspan="2">Table R12 (Friend)</th>
  </tr>
  <tr>
   <td colspan="2"><strong>Keys</strong>: { idFriend1, idFriend2 }</td>
  </tr>
  <tr>
    <td colspan="2"><strong>Functional Dependencies</strong></td>
  </tr>
  <tr>
    <td>FD1201</td>
    <td>{idFriend1} → {idFriend1, idFriend2}</td>
  </tr>
    <tr>
    <td>FD1202</td>
    <td>{idFriend2} → {idFriend1, idFriend2}</td>
  </tr>
  <tr>
    <td>FD1203</td>
    <td>{idFriend1, idFriend2} → {idFriend1, idFriend2, accepted}</td>
  </tr>
  <tr>
    <td><strong>Normal Form</strong></td>
    <td>BCNF</td>
  </tr>
</table>

<table>
  <tr>
    <th colspan="2">Table R13 (CommunityAdmin)</th>
  </tr>
  <tr>
   <td colspan="2"><strong>Keys</strong>: { idCommunityAdmin }</td>
  </tr>
  <tr>
    <td colspan="2"><strong>Functional Dependencies</strong></td>
  </tr>
  <tr>
    <td>FD1301</td>
    <td>{idCommunityAdmin} → {idCommunityAdmin}</td>
  </tr>
  <tr>
    <td><strong>Normal Form</strong></td>
    <td>BCNF</td>
  </tr>
</table>

<table>
  <tr>
    <th colspan="2">Table R14 (CommunityAdmin)</th>
  </tr>
  <tr>
   <td colspan="2"><strong>Keys</strong>: { idCommunityCategory }</td>
  </tr>
  <tr>
    <td colspan="2"><strong>Functional Dependencies</strong></td>
  </tr>
  <tr>
    <td>FD1401</td>
    <td>{idCommunityCategory} → {idCommunityCategory, name}</td>
  </tr>
  <tr>
    <td><strong>Normal Form</strong></td>
    <td>BCNF</td>
  </tr>
</table>

<table>
  <tr>
    <th colspan="2">Table R15 (CommunityAdmin)</th>
  </tr>
  <tr>
   <td colspan="2"><strong>Keys</strong>: { idEventAdmin }</td>
  </tr>
  <tr>
    <td colspan="2"><strong>Functional Dependencies</strong></td>
  </tr>
  <tr>
    <td>FD1501</td>
    <td>{idEventAdmin} → {idEventAdmin}</td>
  </tr>
  <tr>
    <td><strong>Normal Form</strong></td>
    <td>BCNF</td>
  </tr>
</table>

<table>
  <tr>
    <th colspan="2">Table R16 (Report)</th>
  </tr>
  <tr>
   <td colspan="2"><strong>Keys</strong>: { idReport }</td>
  </tr>
  <tr>
    <td colspan="2"><strong>Functional Dependencies</strong></td>
  </tr>
  <tr>
    <td>FD1601</td>
    <td>{idReport} → {idReport, timestamp, context, idCommunity, idMember, idEvent, idComment}</td>
  </tr>
  <tr>
    <td><strong>Normal Form</strong></td>
    <td>BCNF</td>
  </tr>
</table>

<table>
  <tr>
    <th colspan="2">Table R17 (Notification)</th>
  </tr>
  <tr>
   <td colspan="2"><strong>Keys</strong>: { idNotification }</td>
  </tr>
  <tr>
    <td colspan="2"><strong>Functional Dependencies</strong></td>
  </tr>
  <tr>
    <td>FD1701</td>
    <td>{idNotification} → {idNotification, idCommunity, idMember, idEvent, idComment}</td>
  </tr>
  <tr>
    <td><strong>Normal Form</strong></td>
    <td>BCNF</td>
  </tr>
</table>

<table>
  <tr>
    <th colspan="2">Table R18 (Event)</th>
  </tr>
  <tr>
   <td colspan="2"><strong>Keys</strong>: { idEvent }</td>
  </tr>
  <tr>
    <td colspan="2"><strong>Functional Dependencies</strong></td>
  </tr>
  <tr>
    <td>FD1801</td>
    <td>{idEvent} → {idEvent, name, description, imagePath, date, country, city, address, publicLink, isPublic, idCommunity}</td>
  </tr>
  <tr>
    <td><strong>Normal Form</strong></td>
    <td>BCNF</td>
  </tr>
</table>

<table>
  <tr>
    <th colspan="2">Table R19 (EventCategory)</th>
  </tr>
  <tr>
   <td colspan="2"><strong>Keys</strong>: { idEventCategory }</td>
  </tr>
  <tr>
    <td colspan="2"><strong>Functional Dependencies</strong></td>
  </tr>
  <tr>
    <td>FD1901</td>
    <td>{idEventCategory} → {idEventCategory, name}</td>
  </tr>
  <tr>
    <td><strong>Normal Form</strong></td>
    <td>BCNF</td>
  </tr>
</table>

<table>
  <tr>
    <th colspan="2">Table R20 (Event_EventCategory)</th>
  </tr>
  <tr>
   <td colspan="2"><strong>Keys</strong>: { idEvent, idEventCategory }</td>
  </tr>
  <tr>
    <td colspan="2"><strong>Functional Dependencies</strong></td>
  </tr>
  <tr>
    <td>FD2001</td>
    <td>{idEvent} → {idEvent, idEventCategory}</td>
  </tr>
    <tr>
    <td>FD2002</td>
    <td>{idEventCategory} → {idEvent, idEventCategory}</td>
  </tr>
  <tr>
    <td><strong>Normal Form</strong></td>
    <td>BCNF</td>
  </tr>
</table>

> If necessary, description of the changes necessary to convert the schema to BCNF.
> Justification of the BCNF.

The Boyce-Codd Normal Form (BCNF) is used here since it is a slightly stronger database normalization method when compared to the 3NF, better ensuring that there are no data anomalies when making changes to the database.

A relational schema is said to be in the BCNF when, for each of its functional dependencies (X → Y), one of the following happens:

* X → Y is a trivial functional dependency (i.e. Y is contained within X)
* X is a superkey for the schema

## 4. SQL Code

[Link to raw in repository](https://raw.githubusercontent.com/LastLombax/lbaw1714/master/database.SQL?token=AYlAMTKol8Y9z7J3DGtv-ZwywPbYAf2Lks5atmNPwA%3D%3D)

```sql
/* ---------------------------------------------------- */
/*  Generated by Enterprise Architect Version 13.5      */
/*  Created On : 17-mar-2018 14:33:45                   */
/*  DBMS       : PostgreSQL                             */
/* ---------------------------------------------------- */

Inserir
```

