/* ---------------------------------------------------- */
/*  Generated by Enterprise Architect Version 13.5 		*/
/*  Created On : 17-mar-2018 14:33:45 				*/
/*  DBMS       : PostgreSQL 						*/
/* ---------------------------------------------------- */

/* Drop Tables */

DROP TABLE IF EXISTS Comment CASCADE
;

DROP TABLE IF EXISTS Community CASCADE
;

DROP TABLE IF EXISTS CommunityAdmin CASCADE
;

DROP TABLE IF EXISTS CommunityCategory CASCADE
;

DROP TABLE IF EXISTS Event CASCADE
;

DROP TABLE IF EXISTS EventAdmin CASCADE
;

DROP TABLE IF EXISTS EventCategory CASCADE
;

DROP TABLE IF EXISTS Member CASCADE
;

DROP TABLE IF EXISTS Notification CASCADE
;

DROP TABLE IF EXISTS Report CASCADE
;

DROP TABLE IF EXISTS Ticket CASCADE
;

DROP TABLE IF EXISTS TicketPurchase CASCADE
;

/* Create Tables */

CREATE TABLE Comment
(
	idComment integer NOT NULL,
	text text NOT NULL,
	timestamp timestamp without time zone NOT NULL
)
;

CREATE TABLE Community
(
	idCommunity integer NOT NULL,
	name varchar(64) NOT NULL,
	description varchar(256) NOT NULL,
	creationDate date NOT NULL,
	imagePath path NULL,
	publicLink path NULL,
	isPublic boolean NOT NULL
)
;

CREATE TABLE CommunityAdmin
(
	idCommunityAdmin integer NOT NULL
)
;

CREATE TABLE CommunityCategory
(
	idCommunityCategory integer NOT NULL,
	name varchar(50) NULL
)
;

CREATE TABLE Event
(
	idEvent integer NOT NULL,
	name varchar(64) NOT NULL,
	description varchar(516) NULL,
	imagePath path NULL,
	date date NOT NULL,
	country varchar(50) NOT NULL,
	city varchar(50) NOT NULL,
	address varchar(100) NOT NULL,
	publicLink path NULL,
	isPublic boolean NOT NULL
)
;

CREATE TABLE EventAdmin
(
	idEventAdmin integer NOT NULL
)
;

CREATE TABLE EventCategory
(
	idEventCategory integer NOT NULL,
	name varchar(50) NOT NULL
)
;

CREATE TABLE Member
(
	idMember integer NOT NULL,
	username varchar(16) NOT NULL,
	password text NOT NULL,
	name varchar(50) NOT NULL,
	birthdate date NOT NULL,
	email varchar(50) NOT NULL,
	country varchar(50) NULL,
	city varchar(50) NULL,
	address text NULL,
	taxPayerNumber varchar(20) NULL,
	about varchar(256) NULL,
	profilePicture path NULL,
	registrationDate date NOT NULL,
	sentEmailVerification boolean NOT NULL,
	verifiedEmail boolean NOT NULL,
	isWebsiteAdmin boolean NOT NULL
)
;

CREATE TABLE Notification
(
	idNotification integer NOT NULL
)
;

CREATE TABLE Report
(
	idReport integer NOT NULL,
	timestamp timestamp without time zone NOT NULL,
	itemToReport varchar(50) NOT NULL,
	description text NOT NULL
)
;

CREATE TABLE Ticket
(
	idTicket integer NOT NULL,
	price double precision NOT NULL,
	type varchar(50) NOT NULL,
	initialQuantity integer NOT NULL,
	availableQuantity integer NOT NULL
)
;

CREATE TABLE TicketPurchase
(
	idTicketPurchase integer NOT NULL,
	quantity integer NULL
)
;

/* Create Primary Keys, Indexes, Uniques, Checks */

ALTER TABLE Comment ADD CONSTRAINT PK_Comment
	PRIMARY KEY (idComment)
;

ALTER TABLE Community ADD CONSTRAINT PK_Community
	PRIMARY KEY (idCommunity)
;

CREATE INDEX IXFK_Community_EventCategory ON Community (idCommunity ASC)
;

CREATE INDEX IXFK_Community_Member ON Community (idCommunity ASC)
;

ALTER TABLE CommunityAdmin ADD CONSTRAINT PK_Member
	PRIMARY KEY (idCommunityAdmin)
;

ALTER TABLE CommunityCategory ADD CONSTRAINT PK_CommunityCategory
	PRIMARY KEY (idCommunityCategory)
;

ALTER TABLE Event ADD CONSTRAINT PK_Event
	PRIMARY KEY (idEvent)
;

ALTER TABLE EventAdmin ADD CONSTRAINT PK_Member
	PRIMARY KEY (idEventAdmin)
;

ALTER TABLE EventCategory ADD CONSTRAINT PK_EventCategory
	PRIMARY KEY (idEventCategory)
;

ALTER TABLE Member ADD CONSTRAINT PK_Member
	PRIMARY KEY (idMember)
;

ALTER TABLE Notification ADD CONSTRAINT PK_Notification
	PRIMARY KEY (idNotification)
;

ALTER TABLE Report ADD CONSTRAINT PK_Report
	PRIMARY KEY (idReport)
;

ALTER TABLE Ticket ADD CONSTRAINT PK_Ticket
	PRIMARY KEY (idTicket)
;

CREATE INDEX IXFK_Ticket_Event ON Ticket (idTicket ASC)
;

CREATE INDEX IXFK_Ticket_Event_02 ON Ticket (idTicket ASC)
;

ALTER TABLE TicketPurchase ADD CONSTRAINT PK_TicketPurchase
	PRIMARY KEY (idTicketPurchase)
;

/* Create Foreign Key Constraints */

ALTER TABLE Ticket ADD CONSTRAINT FK_Ticket_Event_02
	FOREIGN KEY (idTicket) REFERENCES  () ON DELETE No Action ON UPDATE No Action
;
